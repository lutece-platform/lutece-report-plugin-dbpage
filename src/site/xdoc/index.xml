<?xml version="1.0" encoding="UTF-8"?>
<document>
    <properties>
        <title>Introduction</title>
    </properties>
    <body>
        <section name="Plugin dbpage">
            <subsection name="Introduction">
                <p>
                The dbpage plugin allows to create online reports by extracting data from any database and presenting it 
                with the help of simple HTML templates.
                </p> 
            </subsection>
            <subsection name="Prerequisites">
                <p>
                In order to follow this tutorial, a knowledge of SQL and HTML is needed.
                </p> 
            </subsection>
        </section>
        <section name="Overview of plugin dbpage">
            <subsection name="Choose your datasource(s)">
                <p>
                The datasource is declared as a pool in the <code>db.properties</code>.The datasource may be any database accessible by JDBC
                (i.e MySQL,PostgreSQL,Oracle,Microsoft SQL Server etc ...). The code snippet below shows how a pool may be declared 
                </p>

                <p>
                <pre>
#mypool.poolservice is not a mandatory property
mypool.poolservice=fr.paris.lutece.util.pool.service.LuteceConnectionService
mypool.driver=org.gjt.mm.mysql.Driver
mypool.url=jdbc:mysql://localhost/mydatabase?autoReconnect=true&amp;useUnicode=yes&amp;characterEncoding=utf8
mypool.user=
mypool.password=
mypool.initconns=2
mypool.maxconns=5
mypool.logintimeout=2000
mypool.checkvalidconnectionsql=SELECT 1
                </pre>              
                </p> 
                  <p>
                  Each section can be branched to a different or same pool as shown on the diagram below. The DbPage is composed of all the sections as
                  follows. This allows data synthesis by combination of many sections.
                <center>
                	<img
						src="images/dbpage_manual_002.gif"
						alt="Image" />
                </center>
      
                </p> 
            </subsection>

              <subsection name="Choose parameters to target the appropriate data">
                <p>
                The variables of a report may be a date, a project or any data. The choice of these parameters as variables in order to allow the
                user to scroll through the report depends on your user requirements.
                Please consult the usage section to see a simple usage
                of dbpage in a concrete example
                (e.g MyHelloWorld Report).
                </p> 
            </subsection>
            
            <subsection name="Create the templates or use provided templates for rendering">
                <p>
                Each DbPage has a title and sections. The sections are of type form,table and selects. The choice of a template depends on the
                dataset that is collected by the sql query. Any esthetic concerns will be expressed into the template(colors,styles,size). The DbPage can be declared 
                directly in the Back Office or as text files that are uploaded on the server.This issue is treated in more details in the Usage section.
                </p>
                <p>
                <center>
                	<img
						src="images/dbpage_manual_001.gif"
						alt="Image" />
                </center>
      
                </p> 
                
            </subsection>
            
        </section>
        <section name="Publish in a few clicks">
          <p>
          The dbpage can be published as a portlet so that it can marry completely the general design of the Lutece CMS or as an XPage which will
          be accessed by a specific Url. In general a combination of the two can be used in order to handle form submission to enhance interaction
          while navigation through the data.  
          
          </p>
        </section>
        <section name="MyHelloWorld Report">
            <subsection name="">
                <p>
                The goal of this tutorial is to explain the different steps in order to use the DbPage.
                Let's take a simple SQL structure of some project attributes in a table.
              
                </p>
<p>
<pre>                
CREATE TABLE `project` (
  `project_name` varchar(255) default NULL,
  `project_date_begin` date default NULL,
  `project_budget` varchar(255) default NULL,
  `project_manager` varchar(255) default NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

/*Data for the table `project` */

INSERT  INTO `project`(`project_name`,`project_date_begin`,`project_budget`,`project_manager`) VALUES ('Project Dev UI','2008-12-12','10000','bob'),
('Integration Project','2009-01-05','12000','bob'),
('Financial Software Update','2008-06-09','15000','john'),
('Marketing Project','2009-11-06','30000','mary');
</pre> 
</p>   
                <p>
                  <b>The aim of the report is to publish online the sum of the budgets allocated to each project manager.</b>. The SQL query to 
                  obtain the values is given below.
                <pre>
SELECT project_manager,SUM(project_budget) FROM project GROUP BY project_manager 
                </pre>
                </p> 
            </subsection>
            <subsection name="Create a DbPage directly with web user interface">
                <p>Create a DbPage</p>
                
                <p>Create a section
                <ul>
                    <li>Choose the section type</li>
                    <li>Choose a standard table template</li>
                    <li>Choose the pool</li>
                    <li>Put in the SQL Query</li>               
                </ul>
                </p>
            </subsection>
     <subsection name="The Dbpage from a file">
                <p>
                       The attributes of a dbpage are defined in a file which is named
                        pour nom
                    <code>
                        "<i>mydbpage</i>.properties"
                    </code> and which is found in
                    <code>"WEB-INF/plugins/dbpage"</code>.
                </p>
                <p>
                    <table>
                        <tr>
                            <th>Attribute of the page</th>
                            <th>Mandatory</th>
                            <th>Description</th>
                        </tr>
                        <tr>
                            <td>page.paramname</td>
                            <td>Oui</td>
                            <td>
                                    Name of the dbpage who is used in the request URL:
                                <code>Portal.jsp?page=dbpage&amp;dbpage=<i>dbpage_name</i>
                                </code>.
                            </td>
                        </tr>
                        <tr>
                            <td>page.title</td>
                            <td>Oui</td>
                            <td>
                                    Name of the page which will be title in the web browser and the navigation tree.
                            </td>
                        </tr>
                        <tr>
                            <td>page.nbsections</td>
                            <td>Yes</td>
                            <td>
                                    Number of sections defined for the dbpage.
                            </td>
                        </tr>
                    </table>
                </p>
                <p>
                    <table>
                        <tr>
                            <th>Attribute de section</th>
                            <th>Mandatory</th>
                            <th>Description</th>
                        </tr>
                        <tr>
                            <td>section
                                <i>N</i>.title
                            </td>
                            <td>No</td>
                            <td>Title of the section</td>
                        </tr>
                        <tr>
                            <td>section
                                <i>N</i>.type
                            </td>
                            <td>No</td>
                            <td>
                                    The section types provided are declared in the "/WEB-INF/conf/plugins/dbpage.properties" file.
                                <br />
                                    The base type are "form and "table"
                                         </td>
                        </tr>
                        <tr>
                            <td>section
                                <i>N</i>.template
                            </td>
                            <td>Oui</td>
                            <td>
                                    Relative path of the Html template from
                                    "WEB-INF/plugins/dbpage/".
                            </td>
                        </tr>
                        <tr>
                            <td>section
                                <i>N</i>.column
                            </td>
                            <td>Yes if SQL query</td>
                            <td>
                                    For a table section, the field to be defined in the 
                                    template is the list of titles of the column of the table
                                    for the sql result.
                                    For the "form" section,the field defines the 
                                    bookmarks from the template to be substituted by order
                                    of the columns in the sql query.                          </td>
                        </tr>
                        <tr>
                            <td>section
                                <i>N</i>.sql
                            </td>
                            <td>Yes for "table"</td>
                            <td>
                                    SQL Query which will fill the table.
                            </td>
                        </tr>
                        <tr>
                            <td>section
                                <i>N</i>.pool
                            </td>
                            <td>No</td>
                            <td>
                            Connection pool. The default value is that used by the plugin but can be changed.
                            </td>
                        </tr>
                        <tr>
                            <td>section
                                <i>N</i>.role
                            </td>
                            <td>No</td>
                            <td>
                                The rendering of the section is done when the authenticated user has sufficient right 
                                defined by the role variable.                            </td>
                        </tr>
                    </table>
                </p>
                <p>
                        Here is a small example of the file :
                </p>
                <code>
                    <pre>
page.paramname=mydbpage
page.title=My DbPage Title
page.nbsections=2

# section #1
section1.title=header
section1.type=form
section1.template=mydbpage/hearder.html

# section #2
section2.title=Liste of users
section2.type=table
section2.template=mydbpage/table.html
section2.column=First name , Last name
section2.sql=SELECT first_name , last_name FROM core_admin_user ORDER BY last_name;
                    </pre>
                </code>
            </subsection>
            <subsection name="The database management of the dbpage">
                <p>
                This mode has user interfaces to complete the details used to access the different databases
                for each section. The function can be accessed by the link "Management of DbPages".
                The attributes are the same but the templates are stored on the web application.
                And the SQL query is verified before stored, this reduces runtime errors.
                </p>
                
                    
            </subsection>
        </section>
    </body>
</document>